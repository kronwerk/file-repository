@using System.Data
@using System.Data.SqlClient
@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.EntityFramework;
@model WebApplication2.Models.RepoEditModel

@{
    ViewBag.Title = "";
}

<h2>ViewBag.Title</h2>
@{  
    bool flag = false;
    int id = ViewBag.repoId;
    string connStr = @"Data Source=(LocalDb)\v11.0;AttachDbFilename=|DataDirectory|\aspnet-WebApplication2-20160108044733.mdf;Initial Catalog=aspnet-WebApplication2-20160108044733;Integrated Security=True";
    SqlConnection conn = new SqlConnection(connStr);
    conn.Open();
    string query = "SELECT * FROM Repositories WHERE Id='" + id + "';";
    SqlCommand cmd = new SqlCommand(query, conn);
    SqlDataReader dr = cmd.ExecuteReader();
    dr.Read();
    string owner = dr.GetValue(2).ToString();
}
<div class="row">
    <div class="col-md-4">
        <h3 style="display:inline">@Html.Label("Welcome to " + @dr.GetValue(1).ToString() + "!")   </h3>
        @{
            query = "SELECT * FROM AspNetUsers WHERE Id='" + dr.GetValue(2) + "';";
            cmd = new SqlCommand(query, conn);
            dr.Close();
            dr = cmd.ExecuteReader();         
            dr.Read();
        }
        <h2>Owner: @Html.Label(dr.GetValue(1).ToString())</h2>
        @if(owner==User.Identity.GetUserId()){
            flag=true;
        }
        @if (flag)
        {
            @Html.ActionLink("Delete", "Delete", "Repository", routeValues: new { id = dr.GetValue(0) }, htmlAttributes: new { title = "Delete Repository", @class = "btn btn-default" })
        }
        <center><h2>Users</h2></center>
        @{ 
            query = "SELECT * FROM Connection WHERE Repos='" + id + "';";
            cmd = new SqlCommand(query, conn);
            dr.Close();
            dr = cmd.ExecuteReader();
        }
        <table class="table table-striped table-hover ">
            <tbody>
                @while (dr.Read())
                {
                    <tr class="default">
                        <td><center><h5><b>@dr.GetValue(0).ToString().Trim() </b></h5></center></td>                       
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="col-md-8">
        <center><h1>Files</h1></center>
        @{
            query = "SELECT * FROM Files WHERE Repo='" + id + "';";
            cmd = new SqlCommand(query, conn);
            dr.Close();
            dr = cmd.ExecuteReader();
        }
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <td><center>Name</center></td>
                    <td><center>Type</center></td>
                    <td><center>Last Update Time</center></td>
                    <td><center>Last Update by</center></td>
                    <td><center>Delete</center></td>
                    <td><center>Edit</center></td>

                </tr>
            </thead>
            <tbody>
               
                @while (dr.Read())
                {
                    <tr class="info">
                        <td><center><h5><b>@dr.GetValue(1).ToString().Trim() </b></h5></center></td>
                        <td><center><h5><b>@dr.GetValue(6).ToString().Trim() </b></h5></center></td>
                        <td><center><h5><b>@dr.GetValue(4).ToString().Trim() </b></h5></center></td>
                        <td><center><h5><b>@dr.GetValue(5).ToString().Trim() </b></h5></center></td>
                        @if(flag){
                            <td style="table-layout: auto;width:10%; "> @Html.ActionLink("Delete", "DeleteFile", "Repository", routeValues: new { id = dr.GetValue(0) }, htmlAttributes: new { title = "Delete File", @class = "btn btn-info" })</td>
                            <td style="table-layout: auto;width:10%; "> <a href="#" class=" btn btn-danger">Edit</a></td>
                        }
                    </tr>
                }
                @{
                    conn.Close();
                    conn.Dispose();
                }

            </tbody>
        </table>
        @if (flag) { 
        <center><button class="btn btn-default">@Html.ActionLink("Upload File", "Upload", "Repository", routeValues: null, htmlAttributes: new { title = "New Repository" })</button></center>
        }
    </div>
</div>